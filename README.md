# Landsat Cloud Free Scene Counts

The purpose of these tools is to generate lists of Landsat scene IDs that are "cloudy" and "clear".  To do this, the Landsat quicklook images are first downloaded by path/row and year using the "metadata_csv_image_download.py" script.  After downloading the quicklooks, the "cloudy" images need to manually sorted.  Finally, the scene IDs files are generated by running the "make_quicklook_lists.py" script.

## Landsat Bulk Metadata CSV

The starting point for generating monthly cloud free scene counts is to obtain the Landsat bulk metadata CSV files.  These files are updated each day, but for generating historical scene counts it is only necessary to download them once.  The  CSV files can be downloaded using the provided python script "metadata_csv_download.py" or manually from the [Landsat Bulk Metadata Site](https://landsat.usgs.gov/download-entire-collection-metadata).

```
python metadata_csv_download.py
```

The CSV files can then be filtered and reduced using the provided python script "metadata_csv_reduce.py" or manually.  If the "--filter_conus" command line argument is set, all non-CONUS Landsat path/rows will be removed from the metadata. 

```
python metadata_csv_reduce.py --filter_conus
```

## Quicklook Download

The quicklook download script can be run from the command prompt or by double clicking on the script.  The script will download the quicklooks into separate folders by path/row and year.  Any images that are not L1T (fully georectified) will be automatically moved into a "cloudy" folder within that year.

From the command prompt, change directory into the quicklooks folder, then enter the following command, where FOLDER is the path to the folder containing the bulk metadata CSV files.  If "--csv" is not set, the script will attempt to use the current working directory.
```
python metadata_xml_image_download.py --csv FOLDER
```

If you double click the download script, it should prompt open a GUI prompting you to select the folder containing the CSV files.

The download script can be manually modified to limit the path, rows, or path/rows that are processed.

## Cloudy Scene Sorting

After downloading the quicklook images, they need to be manually sorted to identify the "cloudy" images.  Within each path/row/year folder, manually move each "cloudy" (or image with bad data, snow, etc.) to the "cloudy" folder.

## Clear/Cloudy Scene Lists

The clear and cloudy scene ID lists can be generated either from the command prompt or by double clicking the "make_quicklook_lists.py" script.

From the command prompt, enter the following command:
```
python make_quicklook_lists.py
```

## Command Line Arguments

Both of the python scripts have additional arguments that can be set from the command line.  To view these options, run the script with the "-h" argument.

```
python metadata_csv_image_download.py -h

usage: metadata_csv_image_download.py [-h] [--csv CSV] [--output OUTPUT]
                                      [--landsat LANDSAT]
                                      [--skiplist SKIPLIST] [-o] [-d]

Download Landsat Quicklook images Beware that many values are hardcoded!

optional arguments:
  -h, --help           show this help message and exit
  --csv CSV            Landsat bulk metadata CSV folder (default:
                       /Users/mortonc/Projects/cloud-free-scene-counts)
  --output OUTPUT      Output folder (default: /Users/mortonc/Projects/cloud-
                       free-scene-counts)
  --landsat LANDSAT    Landsat tar.gz folder (default: None)
  --skiplist SKIPLIST  Skips files in skip list (default: None)
  -o, --overwrite      Include existing scenes in scene download list
                       (default: False)
  -d, --debug          Debug level logging (default: 20)


```
